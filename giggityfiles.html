
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Giggity Files</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Oswald', sans-serif; margin:0; background:#111; color:#eee; }
  h1 { text-align:center; margin:1em 0; }
  #news { padding:1em; background:#222; }
  #promos { text-align:center; padding:1em; background:#181818; }
  #promos a { margin:0 10px; color:#4af; text-decoration:none; }
  #promos a:hover { text-decoration:underline; }
  #controls { text-align:center; margin:1em 0; }
  #search, #sort { padding:5px; font-size:1em; }
  #ipBox { text-align:center; margin:1em; color:#ffcc00; }
  #toggleIP { margin-left:10px; padding:3px 6px; cursor:pointer; font-size:0.9em; }
  .repo { border:1px solid #444; margin:0.5em; border-radius:5px; }
  .repo h2 { margin:0; padding:0.5em; background:#333; cursor:pointer; font-size:1.2em; }
  .file-list { display:none; padding:0.5em; list-style:none; }
  .file-list li { margin:0.25em 0; }
  .file-list img { width:16px; vertical-align:middle; margin-right:5px; cursor:pointer; filter:invert(1); }
  .file-list a { color:#fff; font-size:1.1em; text-decoration:none; }
  .file-list a:hover { text-decoration:underline; }
  #reposWrapper { display:flex; }
  #reposSideLeft, #reposSideRight { width:100px; }
  #reposContainer { flex:1; }
  #reposBottom { margin-top:1em; }
</style>
</head>
<body>
<h1>Giggity Files</h1>

<div id="news">Loading news…</div>

<div id="promos">
  <a href="https://giggityfiles.github.io/ads.html" target="_blank">Check out our promos</a>
  <a href="https://giggityfiles.github.io/pullreq" target="_blank">Request a file here</a>
  <a href="https://ggtfiles.blogspot.com" target="_blank">Official Blog</a>
  <a href="https://ggtfiles.fandom.com" target="_blank">Official Fandom Wiki</a>
  <a href="https://giggityfiles.github.io/links.html" target="_blank">Links</a>
</div>

<div id="ipBox">
  <span id="ipDisplay">Loading your IP…</span>
  <button id="toggleIP">Hide IP</button>
</div>

<div id="controls">
  <input type="text" id="search" placeholder="Search repos…" oninput="filterRepos()" />
  <select id="sort" onchange="sortRepos()">
    <option value="az">Sort: A–Z</option>
    <option value="za">Sort: Z–A</option>
  </select>
</div>

<div id="reposWrapper">
  <div id="reposSideLeft">
    <iframe width="100" height="300" style="border:none" src="https://dogspit.nekoweb.org/sidelink.html" name="sidelink"></iframe>
  </div>
  <div id="reposContainer">
    <div id="repos">Loading repos…</div>
    <div id="reposBottom">
      <iframe src="https://john.citrons.xyz/embed?ref=giggityfiles.github.io" style="margin-left:auto;display:block;margin-right:auto;max-width:732px;width:100%;height:94px;border:none;"></iframe>
    </div>
  </div>
  <div id="reposSideRight">
    <iframe width="100" height="300" style="border:none" src="https://dogspit.nekoweb.org/sidelink.html" name="sidelink"></iframe>
  </div>
</div>

<script>
const baseAPI = "https://api.github.com/repos/giggityfiles";
const baseDL = "https://giggityfiles.github.io";
const iconURL = "https://img.icons8.com/?size=256&id=1u78UgAkC1bw&format=png";
const bannedURL = "https://giggityfiles.github.io/bans.json";

let showIP = localStorage.getItem('showIP') !== 'false';
let userIP = null;
let vipPassword = null;
let vipUnlocked = false;

async function fetchIPv4() {
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    return (await res.json()).ip;
  } catch {
    try {
      const res = await fetch("https://ipv4.icanhazip.com");
      return (await res.text()).trim();
    } catch {
      return null;
    }
  }
}
function displayIP() {
  const ipDisplay = document.getElementById('ipDisplay');
  ipDisplay.innerText = showIP ? `Your IP: ${userIP || 'unknown'}` : 'IP hidden';
}
document.getElementById('toggleIP').addEventListener('click', () => {
  showIP = !showIP;
  localStorage.setItem('showIP', showIP);
  displayIP();
});
async function checkBan() {
  if (!userIP) return;
  try {
    const res = await fetch(`${bannedURL}?_=${Date.now()}`);
    const bannedIPs = await res.json();
    if (bannedIPs.includes(userIP)) window.location.href = "/blocked";
  } catch {}
}
setInterval(checkBan, 1000);

let reposAll = [];
let reposFiltered = [];

async function getVipPassword() {
  try {
    const res = await fetch("https://giggityfiles.github.io/assets/vip-pass.txt");
    const encoded = await res.text();
    vipPassword = atob(encoded.trim());
  } catch {
    vipPassword = null;
  }
}

async function loadRepos() {
  try {
    await getVipPassword();
    const res = await fetch("https://api.github.com/users/giggityfiles/repos");
    const repos = await res.json();
    reposAll = repos.filter(r => r.name !== "giggityfiles.github.io");
    const vipIndex = reposAll.findIndex(r => r.name.toLowerCase() === "vip");
    if (vipIndex > -1) {
      const vipRepo = reposAll.splice(vipIndex, 1)[0];
      reposAll.unshift(vipRepo);
    }
    reposFiltered = [...reposAll];
    renderRepos();
  } catch {
    document.getElementById("repos").innerText = "Failed to load repos.";
  }
}

function renderRepos() {
  let html = "";
  for (const repo of reposFiltered) {
    html += `
      <div class="repo">
        <h2 onclick="handleRepoClick('${repo.name}')">${repo.name}</h2>
        <ul id="files-${repo.name}" class="file-list"></ul>
      </div>
    `;
  }
  document.getElementById("repos").innerHTML = html;
}

async function handleRepoClick(repoName) {
  if (repoName.toLowerCase() === "vip") {
    if (!vipUnlocked) {
      if (!vipPassword) return alert("VIP password unavailable.");
      let entered = "";
      while (entered !== vipPassword) {
        entered = prompt("Enter VIP password:");
        if (entered === null) return;
        if (entered !== vipPassword) alert("Incorrect password. Try again.");
      }
      vipUnlocked = true;
    }
  }
  toggleRepo(repoName);
}

async function toggleRepo(repoName, path = "") {
  const list = document.getElementById(`files-${repoName}`);
  if (list.style.display === "block" && !path) {
    list.style.display = "none";
    return;
  }
  try {
    const res = await fetch(`${baseAPI}/${repoName}/contents/${path}`);
    const files = await res.json();
    let html = "";
    if (path) {
      const parentPath = path.split("/").slice(0, -1).join("/");
      html += `<li><button onclick="toggleRepo('${repoName}', '${parentPath}')">..</button></li>`;
    }
    for (const f of files) {
      if (f.type === "dir") {
        html += `<li><img src="${iconURL}" onclick="toggleRepo('${repoName}','${f.path}')"> ${f.name}</li>`;
      } else {
        html += `<li><img src="${iconURL}"><a href="${baseDL}/${repoName}/${f.path}" download>${f.path}</a></li>`;
      }
    }
    list.innerHTML = html;
    list.style.display = "block";
  } catch {
    list.innerHTML = "<li>Failed to load files.</li>";
    list.style.display = "block";
  }
}

function filterRepos() {
  const q = document.getElementById("search").value.toLowerCase();
  reposFiltered = reposAll.filter(r => r.name.toLowerCase().includes(q));
  renderRepos();
}
function sortRepos() {
  const mode = document.getElementById("sort").value;
  reposFiltered.sort((a,b) => mode === "az" ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name));
  renderRepos();
}
async function loadNews() {
  try {
    const res = await fetch(`${baseDL}/news.txt?${Date.now()}`);
    const text = await res.text();
    document.getElementById("news").innerText = text;
  } catch {
    document.getElementById("news").innerText = "Failed to load news.";
  }
}

(async () => {
  userIP = await fetchIPv4();
  displayIP();
  await checkBan();
  loadRepos();
  loadNews();
})();
</script>
<script src="https://youtomb-mobile.github.io/shark.js"></script>
</body>
</html>
